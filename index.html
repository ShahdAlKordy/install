<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù‡ÙˆÙŠØ© Ø¨ÙŠØªÙƒ - ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #f0f2f5;
        }
        .navy-bg { background-color: #001f3f; }
        .navy-text { color: #001f3f; }
        .btn-primary {
            background-color: #001f3f;
            color: white;
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            background-color: #003366;
            transform: translateY(-1px);
        }
        .input-field {
            border: 1px solid #ccd0d5;
            border-radius: 8px;
            padding: 12px;
            width: 100%;
            outline: none;
        }
        .input-field:focus {
            border-color: #001f3f;
            ring: 2px rgba(0, 31, 63, 0.2);
        }
        #loadingOverlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 100;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
        }
    </style>
</head>
<body class="p-4">

    <div id="loadingOverlay">
        <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-white mb-4"></div>
        <p class="text-lg font-bold">Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„ØµÙˆØ±...</p>
        <p class="text-sm opacity-75">ÙŠØ±Ø¬Ù‰ Ø¹Ø¯Ù… Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙØ­Ø©</p>
    </div>

    <div class="max-w-lg mx-auto bg-white rounded-2xl shadow-2xl overflow-hidden">
        <!-- Logo Header -->
        <div class="navy-bg p-8 text-center">
            <img src="logo1.png" alt="Ù‡ÙˆÙŠØ© Ø¨ÙŠØªÙƒ" class="h-24 mx-auto mb-2 object-contain" onerror="this.src='https://via.placeholder.com/200x100?text=Logo1.png'">
            <p class="text-blue-100 text-sm">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ù…ÙŠØ¯Ø§Ù†ÙŠØ©</p>
        </div>

        <form id="orderForm" class="p-6 space-y-5">
            <div>
                <label class="block text-sm font-bold navy-text mb-1">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</label>
                <select id="region" name="region" class="input-field" required onchange="filterNames()">
                    <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø© --</option>
                    <option value="Ø§Ù„Ø±ÙŠØ§Ø¶">Ø§Ù„Ø±ÙŠØ§Ø¶</option>
                    <option value="ØªØ¨ÙˆÙƒ">ØªØ¨ÙˆÙƒ</option>
                    <option value="Ø§Ù„ØºØ±Ø¨ÙŠÙ‡">Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØºØ±Ø¨ÙŠØ©</option>
                    <option value="Ø§Ù„Ø´Ø±Ù‚ÙŠØ©">Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ©</option>
                    <option value="Ø­Ø§Ø¦Ù„">Ø­Ø§Ø¦Ù„</option>
                    <option value="Ø§Ù„Ø¬Ù†ÙˆØ¨ÙŠØ©">Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¬Ù†ÙˆØ¨ÙŠØ©</option>
                </select>
            </div>

            <div>
                <label class="block text-sm font-bold navy-text mb-1">Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</label>
                <select id="delegateName" name="delegateName" class="input-field" required disabled>
                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø£ÙˆÙ„Ø§Ù‹</option>
                </select>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div class="col-span-2 sm:col-span-1">
                    <label class="block text-sm font-bold navy-text mb-1">Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</label>
                    <input type="text" id="orderNumber" name="orderNumber" class="input-field" placeholder="0000" required>
                </div>
                <div class="col-span-2 sm:col-span-1">
                    <label class="block text-sm font-bold navy-text mb-1">Ø¹Ø¯Ø¯ Ø§Ù„Ù„ÙˆØ­Ø§Øª</label>
                    <input type="number" name="platesCount" class="input-field" placeholder="1" required min="1">
                </div>
            </div>

            <div>
                <label class="block text-sm font-bold navy-text mb-1">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙˆØ·Ù†ÙŠ</label>
                <textarea name="nationalAddress" class="input-field" rows="2" placeholder="Ø£Ø¯Ø®Ù„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†" required></textarea>
            </div>

            <div>
                <label class="block text-sm font-bold navy-text mb-1">ØµÙˆØ± Ø§Ù„Ø·Ù„Ø¨</label>
                <input type="file" id="photos" name="photos" class="input-field bg-gray-50" multiple accept="image/*" required>
                <p class="text-[10px] text-gray-400 mt-1">ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¶ÙˆØ­ Ø§Ù„ØµÙˆØ± Ù‚Ø¨Ù„ Ø§Ù„Ø±ÙØ¹</p>
            </div>

            <button type="submit" class="w-full btn-primary font-bold py-4 rounded-xl shadow-lg text-lg">
                Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¢Ù†
            </button>
        </form>

        <div id="message" class="hidden m-6 p-4 rounded-xl text-center font-bold"></div>
    </div>

    <script>
        const delegates = [
            { name: "ØµØ§Ù„Ø­ Ø¬Ø¨Ø±Ø§Ù†", region: "Ø§Ù„Ø±ÙŠØ§Ø¶" },
            { name: "Ø§Ù…Ø¬Ø¯ Ø§Ù„Ø­Ø¯Ø§Ø¯", region: "Ø§Ù„Ø±ÙŠØ§Ø¶" },
            { name: "Ø±Ø¶ÙˆØ§Ù† Ø§Ù„Ø­Ø¯Ø§Ø¯", region: "Ø§Ù„Ø¬Ù†ÙˆØ¨ÙŠØ©" },
            { name: "Ù…Ø­Ù…Ø¯ Ù†Ø¬ÙŠØ¨", region: "Ø§Ù„ØºØ±Ø¨ÙŠÙ‡" },
            { name: "Ù…Ø­Ù…Ø¯ Ù†Ø¬ÙŠØ¨", region: "Ø§Ù„Ø±ÙŠØ§Ø¶" },
            { name: "Ø£Ø­Ù…Ø¯ Ù…Ø¹Ø§Ù†", region: "Ø§Ù„ØºØ±Ø¨ÙŠÙ‡" },
            { name: "Ø¹Ù…Ø± Ø§Ù„Ø²Ø¨ÙŠØ¯ÙŠ", region: "Ø§Ù„Ø±ÙŠØ§Ø¶" },
            { name: "Ø³Ø§Ù…ÙŠ Ø¹Ù…Ø±", region: "Ø­Ø§Ø¦Ù„" },
            { name: "Ø¬Ù…ÙŠÙ„ Ù…Ø­ÙŠØ±Ø²", region: "Ø§Ù„Ø±ÙŠØ§Ø¶" },
            { name: "Ø±Ø§Ù…ÙŠ", region: "Ø§Ù„Ø´Ø±Ù‚ÙŠØ©" },
            { name: "Ø³Ø§Ù„Ù…", region: "Ø§Ù„Ø´Ø±Ù‚ÙŠØ©" },
            { name: "Ù†Ø§ØµØ±", region: "Ø§Ù„Ø´Ø±Ù‚ÙŠØ©" },
            { name: "Ù…Ø­Ù…Ø¯ Ø¹Ø§Ù…Ø±", region: "Ø§Ù„Ø±ÙŠØ§Ø¶" },
            { name: "ØµØ§Ù„Ø­ Ø§Ù„ÙŠØ§ÙØ¹ÙŠ", region: "Ø§Ù„Ø´Ø±Ù‚ÙŠØ©" },
            { name: "Ø³Ø§Ù„Ù… Ù†ÙŠØ§Ø²ÙŠ", region: "Ø§Ù„Ø´Ø±Ù‚ÙŠØ©" },
            { name: "Ø¹Ù„ÙŠ Ø¹Ø¨Ø¯ Ø§Ù„Ø±Ø­Ù…Ù†", region: "Ø§Ù„Ø´Ø±Ù‚ÙŠØ©" }
        ];

        // ğŸŸ¢ Ø¶Ø¹ Ù‡Ù†Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø°ÙŠ Ø­ØµÙ„Øª Ø¹Ù„ÙŠÙ‡ Ù…Ù† Deploy -> Web App
        const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbz-SZ5Hhfq9TaOmZh0-y805woldquEv_vE410S9UOwLvrX0fvaGSVwauefbxjNe01F83A/exec"; 

        function filterNames() {
            const region = document.getElementById('region').value;
            const nameSelect = document.getElementById('delegateName');
            nameSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø§Ø³Ù… --</option>';
            
            if (region) {
                const filtered = delegates.filter(d => d.region === region);
                filtered.forEach(d => {
                    const opt = document.createElement('option');
                    opt.value = d.name;
                    opt.textContent = d.name;
                    nameSelect.appendChild(opt);
                });
                nameSelect.disabled = false;
            } else {
                nameSelect.disabled = true;
            }
        }

        document.getElementById('orderForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const msgDiv = document.getElementById('message');
            const overlay = document.getElementById('loadingOverlay');

            if (WEB_APP_URL.includes("YOUR_SCRIPT_URL")) {
                showMessage("Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… Ø¶Ø¨Ø· Ø±Ø§Ø¨Ø· Ø§Ù„Ø³ÙƒØ±Ø¨Øª!", "bg-red-100 text-red-700");
                return;
            }

            overlay.style.display = 'flex';
            msgDiv.classList.add('hidden');

            try {
                const form = e.target;
                const formData = new FormData(form);
                const files = document.getElementById('photos').files;
                
                const regionVal = formData.get('region');
                const delegateNameVal = formData.get('delegateName');
                const orderNumberVal = formData.get('orderNumber');

                // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ± Ù„Ù€ Base64 Ù…Ø¹ Ø¥Ø¹Ø§Ø¯Ø© ØªØ³Ù…ÙŠØ© Ø§Ù„Ù…Ù„Ù Ø­Ø³Ø¨ Ø§Ù„Ø·Ù„Ø¨
                const photoPromises = Array.from(files).map((file, index) => {
                    return new Promise((resolve, reject) => {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù…ØªØ¯Ø§Ø¯ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø£ØµÙ„ÙŠ (Ù…Ø«Ù„ .jpg Ø£Ùˆ .png)
                            const extension = file.name.split('.').pop();
                            // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ - Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ - Ø§Ù„Ù…Ù†Ø·Ù‚Ø© - Ø±Ù‚Ù… Ø§Ù„Ù„ÙˆØ­Ø©
                            const newFileName = `${orderNumberVal} - ${delegateNameVal} - ${regionVal} - Ù„ÙˆØ­Ø© ${index + 1}.${extension}`;
                            
                            resolve({
                                name: newFileName,
                                type: file.type,
                                data: e.target.result.split(',')[1]
                            });
                        };
                        reader.onerror = reject;
                        reader.readAsDataURL(file);
                    });
                });

                const photosBase64 = await Promise.all(photoPromises);

                const payload = {
                    region: regionVal,
                    delegateName: delegateNameVal,
                    orderNumber: orderNumberVal,
                    nationalAddress: formData.get('nationalAddress'),
                    platesCount: formData.get('platesCount'),
                    photos: photosBase64
                };

                // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… POST Ù…Ø¹ ØªØ­ÙˆÙŠÙ„Ù‡ Ù„Ù†Øµ Ù„ØªØ¬Ù†Ø¨ Ù…Ø´Ø§ÙƒÙ„ CORS
                const response = await fetch(WEB_APP_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                    body: JSON.stringify(payload)
                });

                showMessage("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­! ØªÙ… ØªØ³Ù…ÙŠØ© Ø§Ù„ØµÙˆØ± ÙˆØ­ÙØ¸Ù‡Ø§ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ âœ…", "bg-green-100 text-green-700");
                form.reset();
                document.getElementById('delegateName').disabled = true;

            } catch (error) {
                console.error(error);
                showMessage("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø´Ø± ÙˆØ§Ù„Ø±Ø§Ø¨Ø·", "bg-red-100 text-red-700");
            } finally {
                overlay.style.display = 'none';
            }
        });

        function showMessage(text, classes) {
            const msgDiv = document.getElementById('message');
            msgDiv.textContent = text;
            msgDiv.className = `m-6 p-4 rounded-xl text-center font-bold ${classes}`;
            msgDiv.classList.remove('hidden');
            window.scrollTo(0, document.body.scrollHeight);
        }
    </script>
</body>
</html>
